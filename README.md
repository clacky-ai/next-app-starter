# Next.js 15 Full-Stack Starter

Modern web application template with Next.js 15, React 19, PostgreSQL, and Drizzle ORM.

## AI Agent Reference

**Primary Reference**: `AI-REFERENCE.md` for quick implementation patterns
**Templates**: `templates/` directory for code templates  
**Quick Start**: `pnpm run db:generate && pnpm run db:migrate && pnpm run db:status && pnpm run build`

# Technical Stack

## Core Technologies
- **Next.js 15.5.3**: App Router with route groups and server components
- **React 19.1.0**: Latest features with React Compiler optimizations
- **TypeScript 5.8.3**: Strict mode with full type safety
- **PostgreSQL**: Database with connection pooling
- **Drizzle ORM 0.43.1**: Type-safe database operations with drizzle-zod integration
- **Tailwind CSS 4.1.7**: Utility-first styling with shadcn/ui components

## Architecture Patterns
- **Schema-First Development**: Database schema drives type generation
- **Server Actions**: Form handling with `'use server'` and automatic validation
- **Route Groups**: `(login)`, `(dashboard)`, `(public)` for feature organization
- **Soft Deletes**: Default `deletedAt` timestamp pattern
- **JWT Authentication**: HTTP-only cookies with middleware protection

## File Structure

```
app/                     # Next.js 15 App Router
├── (login)/            # Authentication routes
├── (dashboard)/        # Protected routes  
├── api/                # API endpoints
└── globals.css         # Global styles

lib/db/
├── schema.ts           # Database schema (START HERE)
├── drizzle.ts         # Database connection
├── queries.ts         # Database operations
└── migrations/        # Migration files

components/
├── ui/                # shadcn/ui base components
└── [entity]/          # Feature-specific components
```

## Next.js 15 Critical Changes

### Dynamic Route Parameters
**⚠️ BREAKING CHANGE**: `params` is now a Promise and MUST be awaited.

```typescript
// ❌ Next.js 14 (Will cause errors)
export async function GET(request: NextRequest, { params }: { params: { id: string } }) {
  const id = params.id; // ERROR
}

// ✅ Next.js 15 (Correct)
export async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {
  const { id } = await params; // CORRECT
}
```

## Drizzle ORM Patterns

### Essential Operations
```typescript
// Create with validation
const userData = insertUserSchema.parse(data);
const [created] = await db.insert(users).values(userData).returning();

// Read with soft delete filter
const activeUsers = await db.select().from(users).where(isNull(users.deletedAt));

// Update with timestamp
const [updated] = await db.update(users)
  .set({ ...data, updatedAt: new Date() })
  .where(eq(users.id, id)).returning();

// Soft delete (recommended)
const [deleted] = await db.update(users)
  .set({ deletedAt: new Date() })
  .where(eq(users.id, id)).returning();

// Transaction for multi-table operations
await db.transaction(async (tx) => {
  const [user] = await tx.insert(users).values(userData).returning();
  await tx.insert(activityLogs).values({ userId: user.id, action: 'CREATED' });
});
```

## Authentication System
- JWT tokens in HTTP-only cookies with 24-hour expiration
- bcryptjs password hashing with 10 salt rounds
- Middleware-based route protection
- Activity logging for audit trails

# Dependencies

## Core Stack
- **Next.js (15.5.3)** + **React (19.1.0)** + **TypeScript (5.8.3)**
- **PostgreSQL** + **Drizzle ORM (0.43.1)** + **drizzle-zod**
- **Tailwind CSS (4.1.7)** + **shadcn/ui** + **Radix UI**
- **jose (6.0.11)** + **bcryptjs (3.0.2)** for authentication
- **zod (3.24.4)** for schema validation
- **SWR (2.3.3)** for data fetching

## Quick Start

```bash
# Install dependencies (requires pnpm)
pnpm install

# Setup environment and database
pnpm run db:setup
pnpm run db:migrate
pnpm run db:seed

# Start development server
pnpm run dev
```

**Default User**: `test@test.com` / `admin123`

## Available Scripts

- `pnpm run dev` - Development server
- `pnpm run build` - Production build
- `pnpm run db:setup` - Initialize environment
- `pnpm run db:generate` - Generate migrations
- `pnpm run db:migrate` - Apply migrations
- `pnpm run db:seed` - Seed database
- `pnpm run db:status` - Check database status

## Environment Variables

Required variables (generated by `pnpm run db:setup`):
```env
POSTGRES_URL=postgresql://...
AUTH_SECRET=random-256-bit-secret
```
